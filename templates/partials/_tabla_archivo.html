<div class="seccion-contenido">
    <div class="n-encabezado-explorador">
        <div class="n-encabezado-superior">
            <div class="n-encabezado-info">
                <h3 class="n-encabezado-titulo">Explorador de Archivos</h3>
                <p class="n-encabezado-subtitulo">Gestiona y organiza tus documentos con seguridad</p>
            </div>
            <div class="n-encabezado-acciones-principales">
                <div class="n-buscador-envoltorio">
                    <span class="material-symbols-outlined">search</span>
                    <input type="text" id="entrada-busqueda" placeholder="Buscar archivos..."
                        aria-label="Buscar archivos" />
                </div>
            </div>
        </div>

        <div class="n-encabezado-inferior">
            <div class="n-grupo-filtros">
                <div class="n-item-filtro">
                    <span class="n-etiqueta-filtro">Mostrar:</span>
                    <select id="filtro-tipo" class="n-selector-premium">
                        <option value="todos">Todos los archivos</option>
                        <option value="pdf">PDF</option>
                        <option value="imagen">Imágenes</option>
                        <option value="video">Videos</option>
                        <option value="documento">Documentos</option>
                        <option value="hoja_calculo">Hojas de cálculo</option>
                        <option value="audio">Audio</option>
                    </select>
                </div>
                <div class="n-item-filtro">
                    <span class="n-etiqueta-filtro">Ordenar:</span>
                    <select id="orden-fecha" class="n-selector-premium">
                        <option value="asc">Más antiguos</option>
                        <option value="desc">Más recientes</option>
                    </select>
                </div>
                {% if current_user.is_authenticated %}
                <div class="n-item-filtro n-filtro-accion">
                    <button class="n-btn-nueva-carpeta" onclick="abrirModalEspecifico('modal-crear-carpeta')"
                        aria-label="Crear nueva carpeta">
                        <span class="material-symbols-outlined">create_new_folder</span>
                        <span>Nueva Carpeta</span>
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="n-control-seleccion-global">
        <button id="btn-seleccionar-todo" class="n-btn-seleccionar-todo" title="Seleccionar todo">
            <span class="material-symbols-outlined">checklist</span>
            <span class="n-btn-texto-responsive">Seleccionar todo</span>
        </button>
    </div>

    <div class="n-cuadricula-explorador">
        <div id="cuerpo-tabla" class="n-cuadricula-contenedor">
            <!-- Carpetas -->
            {% for carpeta in carpetas %}
            <div class="n-tarjeta fila-archivo fila-carpeta" data-tipo="carpeta" data-id="{{ carpeta.id }}"
                data-fecha="{{ carpeta.fecha_actualizacion.timestamp() }}">
                <div class="n-tarjeta-seleccion">
                    <input type="checkbox" class="casilla-archivo casilla-carpeta n-tarjeta-casilla" />
                </div>

                <a href="{{ url_for('principal.indice', carpeta_id=carpeta.id) }}" class="n-tarjeta-enlace"
                    style="text-decoration: none !important;">
                    <div class="n-tarjeta-area-icono">
                        <div class="n-carpeta-icono-pila">
                            <span class="material-symbols-outlined">folder</span>
                        </div>
                    </div>
                    <div class="n-tarjeta-info">
                        <span class="nombre" title="{{ carpeta.nombre }}">{{ carpeta.nombre }}</span>
                        <span class="n-tarjeta-meta">Carpeta</span>
                        <span class="n-tarjeta-fecha">Creado: {{ carpeta.fecha_creacion.strftime('%d/%m/%Y %H:%M')
                            }}</span>
                        <span class="n-tarjeta-fecha">Act.: {{ carpeta.fecha_actualizacion.strftime('%d/%m/%Y %H:%M')
                            }}</span>
                    </div>
                </a>

                <div class="n-tarjeta-disparador-acciones" tabindex="0">
                    <button class="n-btn-puntos"><span class="material-symbols-outlined">more_vert</span></button>
                    <div class="n-tarjeta-menu">
                        <button class="n-menu-item btn-eliminar-carpeta" data-id="{{ carpeta.id }}">
                            <span class="material-symbols-outlined">delete</span> Eliminar
                        </button>
                        <a href="{{ url_for('archivos.descargar_carpeta', carpeta_id=carpeta.id) }}"
                            class="n-menu-item">
                            <span class="material-symbols-outlined">download</span> Descargar
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}

            <!-- Archivos -->
            {% for archivo in archivos %}
            <div class="n-tarjeta fila-archivo" data-tipo="{{ archivo.tipo }}" data-id="{{ archivo.id }}"
                data-fecha="{{ archivo.fecha_subida.timestamp() }}">
                <div class="n-tarjeta-seleccion">
                    <input type="checkbox" class="casilla-archivo n-tarjeta-casilla" />
                </div>

                <div class="n-tarjeta-area-previsualizacion">
                    <div class="n-archivo-icono-grande icon-{{ archivo.tipo }}">
                        <span class="material-symbols-outlined">
                            {% if archivo.tipo == 'pdf' %}picture_as_pdf
                            {% elif archivo.tipo == 'imagen' %}image
                            {% elif archivo.tipo == 'video' %}movie
                            {% elif archivo.tipo in ['documento', 'word'] %}description
                            {% elif archivo.tipo in ['hoja_calculo', 'excel'] %}table_chart
                            {% elif archivo.tipo in ['presentacion', 'powerpoint'] %}slideshow
                            {% elif archivo.tipo == 'audio' %}audio_file
                            {% elif archivo.tipo == 'archivo' %}folder_zip
                            {% elif archivo.tipo == 'codigo' %}code
                            {% else %}draft{% endif %}
                        </span>
                    </div>
                </div>

                <div class="n-tarjeta-info">
                    <span class="nombre" title="{{ archivo.nombre }}">{{ archivo.nombre }}</span>
                    <span class="n-tarjeta-meta">{{ archivo.tamano }}</span>
                    <span class="n-tarjeta-fecha">Subido: {{ archivo.fecha_subida.strftime('%d/%m/%Y %H:%M') }}</span>
                </div>

                <div class="n-tarjeta-disparador-acciones" tabindex="0">
                    <button class="n-btn-puntos"><span class="material-symbols-outlined">more_vert</span></button>
                    <div class="n-tarjeta-menu">
                        <button class="n-menu-item btn-eliminar-disparador" data-id="{{ archivo.id }}">
                            <span class="material-symbols-outlined">delete</span> Eliminar
                        </button>
                        <a href="{{ url_for('archivos.descargar_archivo', archivo_id=archivo.id) }}" class="n-menu-item"
                            download>
                            <span class="material-symbols-outlined">download</span> Descargar
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% if not carpetas and not archivos %}
            <div id="fila-sin-archivos" class="n-cuadricula-vacia">
                <div class="n-caja-vacia">
                    <span class="material-symbols-outlined">cloud_off</span>
                    <h3>Sin archivos todavía</h3>
                    <p>Suéltalos aquí para empezar a organizar tu espacio</p>
                </div>
            </div>
            {% endif %}
        </div> <!-- cuerpo-tabla -->
    </div> <!-- n-cuadricula-explorador -->

</div> <!-- fin seccion-contenido -->

<!-- Barra de Acciones Masivas -->
<div id="barra-acciones-masivas" class="n-barra-flotante-premium" style="display: none;">
    <div class="n-contenido-flotante">
        <div class="n-contador-seleccion">
            <span class="material-symbols-outlined">check_circle</span>
            <span id="contador-seleccionados" class="n-contador-texto">0 seleccionados</span>
        </div>
        <div class="n-acciones-flotantes">
            <button id="btn-descargar-multiples" class="n-btn-masivo n-btn-masivo-descargar">
                <span class="material-symbols-outlined">download_for_offline</span>
                <span>Descargar ZIP</span>
            </button>
            <button id="btn-eliminar-multiples" class="n-btn-masivo n-btn-masivo-eliminar">
                <span class="material-symbols-outlined">delete_forever</span>
                <span>Eliminar Selección</span>
            </button>
            <div class="n-divisor-masivo"></div>
            <button id="btn-cerrar-barra" class="n-btn-masivo-cerrar" title="Cancelar selección">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
    </div>
</div>
